<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Plant to Fish Aquaponics Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #0f172a;
      --card: #111827;
      --accent: #22c55e;
      --accent-soft: rgba(34, 197, 94, 0.12);
      --border: #1f2937;
      --text: #e5e7eb;
      --muted: #cbd5e1;
    }
    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #111827, #020617);
      color: var(--text);
      min-height: 100vh;
      display: flex;
      justify-content: center;
      padding: 1.5rem;
    }
    .app {
      width: 100%;
      max-width: 980px;
      background: rgba(15,23,42,0.97);
      border-radius: 1.5rem;
      padding: 1.5rem;
      border: 1px solid rgba(148,163,184,0.7);
      box-shadow:
        0 20px 50px rgba(15,23,42,0.9),
        0 0 0 1px rgba(15,23,42,0.7);
    }

    .hero {
      position: relative;
      border-radius: 1rem;
      overflow: hidden;
      margin-bottom: 1.1rem;
      border: 1px solid rgba(148,163,184,0.6);
    }
    .hero img {
      width: 100%;
      display: block;
    }
    .hero-overlay {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      padding: 0.8rem 1rem 0.9rem;
      background: linear-gradient(to bottom, rgba(15,23,42,0.95), transparent);
      text-align: center;
      pointer-events: none;
    }
    .hero-title {
      background: rgba(0,0,0,0.6);
      padding: 6px 12px;
      border-radius: 8px;
      font-size: 1.6rem;
      font-weight: 700;
      text-shadow: 0 2px 6px rgba(0,0,0,0.9);
    }
    .hero-sub {
      margin-top: 0.15rem;
      font-size: 0.9rem;
      color: #f9fafb;
      text-shadow: 0 2px 5px rgba(0,0,0,0.8);
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1.25rem;
    }
    .card {
      background: var(--card);
      border-radius: 1rem;
      padding: 1rem 1.1rem 1.1rem;
      border: 1px solid var(--border);
    }
    .card h2 {
      margin: 0 0 0.8rem;
      font-size: 0.98rem;
      text-transform: uppercase;
      letter-spacing: 0.07em;
      color: var(--muted);
    }
    .field { margin-bottom: 0.65rem; }
    label {
      display: flex;
      justify-content: space-between;
      align-items: center;
      font-size: 0.82rem;
      color: var(--muted);
      margin-bottom: 0.12rem;
    }
    label small {
      font-size: 0.7rem;
      color: var(--muted);
    }
    .auto-tag {
      margin-left: 0.35rem;
      padding: 0.05rem 0.4rem;
      border-radius: 999px;
      border: 1px solid rgba(148,163,184,0.7);
      font-size: 0.62rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      background: rgba(15,23,42,0.9);
      color: #e5e7eb;
    }
    input[type="number"], select {
      width: 100%;
      padding: 0.5rem 0.65rem;
      border-radius: 0.55rem;
      border: 1px solid var(--border);
      background: #020617;
      color: var(--text);
      font-size: 0.88rem;
      outline: none;
      transition: border 0.15s, box-shadow 0.15s, background 0.15s;
    }
    input[type="number"]:focus, select:focus {
      border-color: var(--accent);
      box-shadow: 0 0 0 1px var(--accent-soft);
      background: #020814;
    }
    input[disabled] {
      background: rgba(15,23,42,0.95);
      border-style: dashed;
      border-color: rgba(148,163,184,0.9);
      color: #e5e7eb;
    }
    .row {
      display: flex;
      gap: 0.6rem;
    }
    .row > .field { flex: 1; }
    .row-inline {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 0.6rem;
    }
    .row-inline-3 {
      display: grid;
      grid-template-columns: repeat(3, minmax(0, 1fr));
      gap: 0.4rem;
    }
    .output-main {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 0.75rem;
      margin-top: 0.5rem;
    }
    .stat {
      border-radius: 0.9rem;
      padding: 0.65rem 0.85rem;
      background: radial-gradient(circle at top left, rgba(34,197,94,0.12), #020617);
      border: 1px solid rgba(55,65,81,0.9);
    }
    .stat-label {
      font-size: 0.76rem;
      color: var(--muted);
      margin-bottom: 0.18rem;
    }
    .stat-value {
      font-size: 1.08rem;
      font-weight: 650;
    }
    .stat-sub {
      font-size: 0.7rem;
      color: var(--muted);
      margin-top: 0.12rem;
    }
    .muted {
      font-size: 0.78rem;
      color: var(--muted);
      margin-top: 0.55rem;
    }
    .muted strong { color: var(--accent); }
    .warn { color: #fecaca; font-weight: 500; }

    /* Gap/surplus colours */
    .gap-positive {
      color: #60a5fa; /* blue for surplus */
    }
    .gap-negative {
      color: #f97373; /* red for gap/deficit */
    }

    @media (max-width: 640px) {
      body { padding: 1rem; }
      .app { padding: 1.1rem; border-radius: 1rem; }
      .hero-title {
        background: rgba(0,0,0,0.6);
        padding: 6px 12px;
        border-radius: 8px;
        font-size: 1.25rem;
      }
      .hero-sub { font-size: 0.8rem; }
      .row-inline-3 {
        grid-template-columns: repeat(1, minmax(0, 1fr));
      }
    }
  </style>

  <style>
    body.light {
      --bg: #f4f4f4;
      --card: #ffffff;
      --accent: #22c55e;
      --border: #d0d0d0;
      --text: #111827;
      --muted: #374151;
      background: #fafafa !important;
      color: #111827 !important;
    }
    body.light .app {
      background: #ffffff !important;
      color: #111827 !important;
    }
    body.light .card {
      background: #ffffff !important;
      border-color: #d0d0d0 !important;
    }
    body.light input[type="number"],
    body.light select {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #111827;
    }
    body.light input[disabled] {
      background: #e5e7eb;
      border-color: #9ca3af;
      color: #111827;
    }
    .theme-toggle {
      position:absolute;
      top:10px;
      right:10px;
      padding:6px 12px;
      border-radius:8px;
      background:#22c55e;
      color:white;
      cursor:pointer;
      font-weight:600;
      border:none;
    }
  </style>

  <script>
    function toggleTheme() {
      document.body.classList.toggle("light");
    }
  </script>
</head>
<body>
<button class='theme-toggle' onclick='toggleTheme()'>Theme</button>
<div class="app">

  <div class="hero">
    <img src="app-header.jpg" alt="Think Namibia Aquaponics 2025" />
    <div class="hero-overlay">
      <div class="hero-title">Plant to Fish Aquaponics Calculator</div>
      <div class="hero-sub">Balance plant feed demand with fish biomass · DWC + Gravel</div>
    </div>
  </div>

  <div class="grid">
    <!-- PLANT CARD -->
    <section class="card">
      <h2>Plant inputs</h2>

      <!-- DWC -->
      <div class="field">
        <label>DWC bed length (m)</label>
        <input id="dwcLength" type="number" step="0.01" value="2.3" />
      </div>

      <div class="field">
        <label>DWC bed width (m)</label>
        <input id="dwcWidth" type="number" step="0.01" value="1.17" />
      </div>

      <div class="field">
        <label>
          DWC area per bed (m²)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="dwcArea" type="number" disabled />
      </div>

      <div class="field">
        <label>Number of DWC beds</label>
        <input id="dwcBeds" type="number" step="1" value="1" />
      </div>

      <div class="field">
        <label>
          Total DWC area (m²)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="dwcAreaTotal" type="number" disabled />
      </div>

      <div class="field">
        <label>
          DWC area used (%)
          <small>close beds when biomass is low</small>
        </label>
        <select id="dwcUsePct">
          <option value="100" selected>100 %</option>
          <option value="75">75 %</option>
          <option value="50">50 %</option>
          <option value="25">25 %</option>
        </select>
      </div>

      <div class="field">
        <label>
          Effective DWC area used (m²)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="dwcAreaUsed" type="number" disabled />
      </div>

      <div class="field">
        <label>DWC feed rate (g/m²·day)</label>
        <select id="dwcFeedRate">
          <option value="15">15</option>
          <option value="20">20</option>
          <option value="25" selected>25</option>
          <option value="30">30</option>
          <option value="35">35</option>
        </select>
      </div>

      <div class="field">
        <label>
          DWC feed floor (kg/day)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="dwcFeedFloor" type="number" disabled />
      </div>

      <div class="field">
        <label>
          Include gravel media?
          <small>uncheck for DWC-only</small>
        </label>
        <input id="includeGravel" type="checkbox" checked />
      </div>

      <!-- Gravel -->
      <div class="field">
        <label>Gravel bed length (m)</label>
        <input id="gravelLength" type="number" step="0.1" value="2.0" />
      </div>

      <div class="field">
        <label>Gravel bed width (m)</label>
        <input id="gravelWidth" type="number" step="0.1" value="1.6" />
      </div>

      <div class="field">
        <label>
          Gravel bed area (m²)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="gravelAreaPerBed" type="number" disabled />
      </div>

      <div class="field">
        <label>Number of gravel beds</label>
        <input id="gravelBeds" type="number" step="1" value="2" />
      </div>

      <div class="field">
        <label>
          Total gravel area (m²)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="gravelArea" type="number" disabled />
      </div>

      <div class="field">
        <label>
          Gravel area used (%)
          <small>close beds when biomass is low</small>
        </label>
        <select id="gravelUsePct">
          <option value="100" selected>100 %</option>
          <option value="75">75 %</option>
          <option value="50">50 %</option>
          <option value="25">25 %</option>
        </select>
      </div>

      <div class="field">
        <label>
          Effective gravel area used (m²)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="gravelAreaUsed" type="number" disabled />
      </div>

      <div class="row">
        <div class="field">
          <label>Gravel feed rate (g/m²·day)</label>
          <select id="gravelFeedRate">
            <option value="30">30</option>
            <option value="35">35</option>
            <option value="40" selected>40</option>
            <option value="45">45</option>
          </select>
        </div>
      </div>

      <div class="field">
        <label>
          Gravel feed floor (kg/day)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="gravelFeedFloor" type="number" disabled />
      </div>

      <div class="field">
        <label>
          Combined plant feed demand (kg/day)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="plantDemand" type="number" disabled />
      </div>

      <p class="muted">
        Set bed size, number of beds, % of area used and feed rates (g/m²·day). Reducing % area is a quick way to match lower fish biomass.
      </p>

      <p class="muted" style="font-size:0.7rem; margin-top:0.9rem;">
        © by Patrick Hilger · Version 1 (2025)
      </p>
    </section>

    <!-- FISH CARD -->
    <section class="card">
      <h2>Fish & outputs</h2>

      <div class="field">
        <label>Planning feeding rate for biomass requirement (%BW/day)</label>
        <select id="feedPercent">
          <option value="2">2 %</option>
          <option value="2.5">2.5 %</option>
          <option value="3">3 %</option>
          <option value="3.5" selected>3.5 %</option>
          <option value="4">4 %</option>
          <option value="5">5 %</option>
        </select>
      </div>

      <div class="field">
        <label>
          Effective %BW/day (planning)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="effectiveBW" type="text" disabled />
      </div>

      <div class="field">
        <label>Reference fish weight for suggestion (g)</label>
        <select id="refAvgW">
          <option value="50">50 g</option>
          <option value="100">100 g</option>
          <option value="150" selected>150 g</option>
          <option value="200">200 g</option>
          <option value="300">300 g</option>
        </select>
      </div>

      <!-- Tank 1 -->
      <div class="field">
        <label>Tank 1</label>
        <div class="row-inline-3">
          <div class="field">
            <label><small>Avg weight (g)</small></label>
            <input id="t1AvgW" type="number" step="1" value="150" />
          </div>
          <div class="field">
            <label><small>Fish count</small></label>
            <input id="t1Count" type="number" step="1" value="0" />
          </div>
          <div class="field">
            <label><small>Feed %BW/day</small></label>
            <select id="t1FeedPct">
              <option value="2">2 %</option>
              <option value="2.5">2.5 %</option>
              <option value="3">3 %</option>
              <option value="3.5" selected>3.5 %</option>
              <option value="4">4 %</option>
              <option value="5">5 %</option>
            </select>
          </div>
        </div>
        <div class="field" style="margin-top:0.35rem;">
          <label>
            <small>Tank 1 feed (g/day)</small>
            <span class="auto-tag">AUTO</span>
          </label>
          <input id="t1Feed" type="number" disabled />
        </div>
        <div class="field" style="margin-top:0.25rem;">
          <label>
            <small>Tank 1 biomass (kg)</small>
            <span class="auto-tag">AUTO</span>
          </label>
          <input id="t1BiomassField" type="number" disabled />
        </div>
      </div>

      <!-- Tank 2 -->
      <div class="field">
        <label>Tank 2</label>
        <div class="row-inline-3">
          <div class="field">
            <label><small>Avg weight (g)</small></label>
            <input id="t2AvgW" type="number" step="1" value="150" />
          </div>
          <div class="field">
            <label><small>Fish count</small></label>
            <input id="t2Count" type="number" step="1" value="0" />
          </div>
          <div class="field">
            <label><small>Feed %BW/day</small></label>
            <select id="t2FeedPct">
              <option value="2">2 %</option>
              <option value="2.5">2.5 %</option>
              <option value="3">3 %</option>
              <option value="3.5" selected>3.5 %</option>
              <option value="4">4 %</option>
              <option value="5">5 %</option>
            </select>
          </div>
        </div>
        <div class="field" style="margin-top:0.35rem;">
          <label>
            <small>Tank 2 feed (g/day)</small>
            <span class="auto-tag">AUTO</span>
          </label>
          <input id="t2Feed" type="number" disabled />
        </div>
        <div class="field" style="margin-top:0.25rem;">
          <label>
            <small>Tank 2 biomass (kg)</small>
            <span class="auto-tag">AUTO</span>
          </label>
          <input id="t2BiomassField" type="number" disabled />
        </div>
      </div>

      <!-- Tank 3 -->
      <div class="field">
        <label>Tank 3</label>
        <div class="row-inline-3">
          <div class="field">
            <label><small>Avg weight (g)</small></label>
            <input id="t3AvgW" type="number" step="1" value="150" />
          </div>
          <div class="field">
            <label><small>Fish count</small></label>
            <input id="t3Count" type="number" step="1" value="0" />
          </div>
          <div class="field">
            <label><small>Feed %BW/day</small></label>
            <select id="t3FeedPct">
              <option value="2">2 %</option>
              <option value="2.5">2.5 %</option>
              <option value="3">3 %</option>
              <option value="3.5" selected>3.5 %</option>
              <option value="4">4 %</option>
              <option value="5">5 %</option>
            </select>
          </div>
        </div>
        <div class="field" style="margin-top:0.35rem;">
          <label>
            <small>Tank 3 feed (g/day)</small>
            <span class="auto-tag">AUTO</span>
          </label>
          <input id="t3Feed" type="number" disabled />
        </div>
        <div class="field" style="margin-top:0.25rem;">
          <label>
            <small>Tank 3 biomass (kg)</small>
            <span class="auto-tag">AUTO</span>
          </label>
          <input id="t3BiomassField" type="number" disabled />
        </div>
      </div>

      <div class="field">
        <label>
          Your fish biomass (kg)
          <span class="auto-tag">AUTO</span>
        </label>
        <input id="actualBiomass" type="number" disabled />
      </div>

      <div class="output-main">
        <div class="stat">
          <div class="stat-label">Required fish biomass</div>
          <div class="stat-value" id="biomassReq">0.00 kg</div>
          <div class="stat-sub">Fish mass needed to support plant demand (planning %BW)</div>
        </div>
        <div class="stat">
          <div class="stat-label">Your fish biomass</div>
          <div class="stat-value" id="yourBiomassStat">0.00 kg</div>
          <div class="stat-sub">From tank 1–3 entries</div>
        </div>
        <div class="stat">
          <div class="stat-label">Biomass gap / surplus</div>
          <div class="stat-value" id="biomassGapStat">0.00 kg</div>
          <div class="stat-sub">Blue = surplus, Red = gap</div>
        </div>
        <div class="stat">
          <div class="stat-label">Suggested fish count</div>
          <div class="stat-value" id="fishCount">0</div>
          <div class="stat-sub" id="fishCountSub">At reference weight</div>
        </div>
        <div class="stat">
          <div class="stat-label">Plant-demand feed</div>
          <div class="stat-value" id="plantDemandStat">0.000 kg/day</div>
          <div class="stat-sub">From DWC + gravel areas</div>
        </div>
        <div class="stat">
          <div class="stat-label">Actual tank feed</div>
          <div class="stat-value" id="actualFeedStat">0.000 kg/day</div>
          <div class="stat-sub">Sum of Tank 1–3 feed</div>
        </div>
        <div class="stat">
          <div class="stat-label">TAN-N/day</div>
          <div class="stat-value" id="tanPerDay">0.0 g</div>
          <div class="stat-sub">28.8 g TAN per kg feed (from plant demand)</div>
        </div>
        <div class="stat">
          <div class="stat-label">NO₃⁻/day</div>
          <div class="stat-value" id="no3PerDay">0.0 g</div>
          <div class="stat-sub">NO₃⁻ ≈ TAN × 4.43</div>
        </div>
      </div>

      <p class="muted" id="bwHint">
        Planning feeding rate is within typical 2–6 % BW/day band.
      </p>
      <p class="muted" id="biomassHint">
        Set feed % per tank based on fish size. Use planning %BW to size biomass for plant demand; use per-tank % to manage actual feeding.
      </p>
      <div class="footer-notes" style="margin-top:18px; padding-top:14px; border-top:1px solid #334155; font-size:0.85rem; color:#cbd5e1;">
        <h3 style="margin:0 0 6px; color:#e2e8f0;">System Notes</h3>
        <p><strong>TAN (Total Ammonia Nitrogen)</strong>: amount of ammonia-N released from feed digestion. Using ~28.8 g TAN per kg of 30% protein feed.</p>
        <p><strong>%BW/day</strong>: percent of total fish biomass fed daily. Typical tilapia grow-out range: 2–6%.</p>
        <p><strong>Feeding guidance</strong>: higher %BW/day for juveniles/warm water; reduce for larger fish or cooler water. Never overfeed to satisfy plant demand—adjust biomass instead.</p>
        <p><strong>Feed rate impact:</strong> Feed input directly drives TAN and nitrate output; stable feeding helps maintain biofilter and plant uptake balance.</p>
      </div>
    </section>
  </div>
</div>

<script>
  function toNum(v, defVal) {
    var n = parseFloat(v);
    return isNaN(n) ? defVal : n;
  }

  function updateCalc() {
    // DWC inputs
    var dwcL = toNum(document.getElementById("dwcLength").value, 0);
    var dwcW = toNum(document.getElementById("dwcWidth").value, 0);
    var dwcBeds = toNum(document.getElementById("dwcBeds").value, 1);
    var dwcRate = toNum(document.getElementById("dwcFeedRate").value, 0);
    var dwcUsePct = toNum(document.getElementById("dwcUsePct").value, 100);

    // Gravel inputs
    var includeGravel = document.getElementById("includeGravel").checked;
    var gravelL = toNum(document.getElementById("gravelLength").value, 0);
    var gravelW = toNum(document.getElementById("gravelWidth").value, 0);
    var gravelBeds = toNum(document.getElementById("gravelBeds").value, 0);
    var gravelRate = toNum(document.getElementById("gravelFeedRate").value, 0);
    var gravelUsePct = toNum(document.getElementById("gravelUsePct").value, 100);

    // Planning %BW for biomass requirement
    var feedPctPlan = toNum(document.getElementById("feedPercent").value, 0);
    var feedFracPlan = feedPctPlan / 100.0;

    // Reference weight for suggested count
    var refAvgW = toNum(document.getElementById("refAvgW").value, 150);

    // Tanks
    var t1AvgW = toNum(document.getElementById("t1AvgW").value, 0);
    var t1Count = toNum(document.getElementById("t1Count").value, 0);
    var t1FeedPct = toNum(document.getElementById("t1FeedPct").value, feedPctPlan);
    var t1FeedFrac = t1FeedPct / 100.0;

    var t2AvgW = toNum(document.getElementById("t2AvgW").value, 0);
    var t2Count = toNum(document.getElementById("t2Count").value, 0);
    var t2FeedPct = toNum(document.getElementById("t2FeedPct").value, feedPctPlan);
    var t2FeedFrac = t2FeedPct / 100.0;

    var t3AvgW = toNum(document.getElementById("t3AvgW").value, 0);
    var t3Count = toNum(document.getElementById("t3Count").value, 0);
    var t3FeedPct = toNum(document.getElementById("t3FeedPct").value, feedPctPlan);
    var t3FeedFrac = t3FeedPct / 100.0;

    var t1Biomass = (t1AvgW * t1Count) / 1000.0;
    var t2Biomass = (t2AvgW * t2Count) / 1000.0;
    var t3Biomass = (t3AvgW * t3Count) / 1000.0;
    var actualBiomass = t1Biomass + t2Biomass + t3Biomass;

    // DWC areas
    var dwcAreaPerBed = dwcL * dwcW;
    var totalDwcArea = dwcAreaPerBed * (dwcBeds > 0 ? dwcBeds : 0);
    var usedDwcArea = totalDwcArea * (dwcUsePct / 100.0);

    // Gravel areas
    var gravelAreaPerBed = gravelL * gravelW;
    var totalGravelArea = gravelAreaPerBed * (gravelBeds > 0 ? gravelBeds : 0);
    var usedGravelArea = includeGravel
      ? totalGravelArea * (gravelUsePct / 100.0)
      : 0;

    // Feed floors based on USED areas (plant side)
    var dwcFeedFloor = (usedDwcArea * dwcRate) / 1000.0;
    var gravelFeedFloor = (usedGravelArea * gravelRate) / 1000.0;
    var plantDemand = dwcFeedFloor + gravelFeedFloor;

    // Required biomass for plant demand using planning %BW
    var biomassReq = 0;
    if (feedFracPlan > 0) {
      biomassReq = plantDemand / feedFracPlan;
    }
    // suggested fish count at chosen reference weight
    var fishCount = refAvgW > 0 ? biomassReq / (refAvgW / 1000.0) : 0;

    // Per tank actual feed (g/day)
    var t1Feed = t1Biomass * t1FeedFrac * 1000.0;
    var t2Feed = t2Biomass * t2FeedFrac * 1000.0;
    var t3Feed = t3Biomass * t3FeedFrac * 1000.0;
    var totalActualFeedKg = (t1Feed + t2Feed + t3Feed) / 1000.0;

    var biomassGap = actualBiomass - biomassReq; // + = surplus, - = deficit

    var tanPerDay = plantDemand * 28.8;
    var no3PerDay = tanPerDay * 4.43;

    // Write back to UI - plant side
    document.getElementById("dwcArea").value = dwcAreaPerBed.toFixed(2);
    document.getElementById("dwcAreaTotal").value = totalDwcArea.toFixed(2);
    document.getElementById("dwcAreaUsed").value = usedDwcArea.toFixed(2);
    document.getElementById("dwcFeedFloor").value = dwcFeedFloor.toFixed(3);

    document.getElementById("gravelAreaPerBed").value = gravelAreaPerBed.toFixed(2);
    document.getElementById("gravelArea").value = totalGravelArea.toFixed(2);
    document.getElementById("gravelAreaUsed").value = usedGravelArea.toFixed(2);
    document.getElementById("gravelFeedFloor").value = gravelFeedFloor.toFixed(3);

    document.getElementById("plantDemand").value = plantDemand.toFixed(3);

    // Fish side
    document.getElementById("effectiveBW").value = feedPctPlan.toFixed(2) + " % BW/day";
    document.getElementById("biomassReq").textContent = biomassReq.toFixed(2) + " kg";
    document.getElementById("actualBiomass").value = actualBiomass.toFixed(2);
    document.getElementById("yourBiomassStat").textContent = actualBiomass.toFixed(2) + " kg";

    var gapEl = document.getElementById("biomassGapStat");
    gapEl.textContent = biomassGap.toFixed(2) + " kg";
    gapEl.classList.remove("gap-positive", "gap-negative");
    if (biomassGap > 0.1) {
      gapEl.classList.add("gap-positive");
    } else if (biomassGap < -0.1) {
      gapEl.classList.add("gap-negative");
    }

    document.getElementById("fishCount").textContent = isFinite(fishCount) ? Math.round(fishCount) : 0;
    document.getElementById("fishCountSub").textContent =
      "At " + refAvgW.toFixed(0) + " g reference weight";

    document.getElementById("plantDemandStat").textContent = plantDemand.toFixed(3) + " kg/day";
    document.getElementById("actualFeedStat").textContent = totalActualFeedKg.toFixed(3) + " kg/day";

    document.getElementById("tanPerDay").textContent = tanPerDay.toFixed(1) + " g";
    document.getElementById("no3PerDay").textContent = no3PerDay.toFixed(1) + " g";

    // Per tank outputs
    document.getElementById("t1Feed").value = t1Feed.toFixed(1);
    document.getElementById("t2Feed").value = t2Feed.toFixed(1);
    document.getElementById("t3Feed").value = t3Feed.toFixed(1);

    document.getElementById("t1BiomassField").value = t1Biomass.toFixed(2);
    document.getElementById("t2BiomassField").value = t2Biomass.toFixed(2);
    document.getElementById("t3BiomassField").value = t3Biomass.toFixed(2);

    var hint = document.getElementById("bwHint");
    if (feedFracPlan < 0.02 || feedFracPlan > 0.06) {
      hint.innerHTML = '<span class="warn">Warning:</span> planning feeding rate outside typical 2–6 % BW/day band.';
    } else {
      hint.textContent = 'Planning feeding rate is within typical 2–6 % BW/day band.';
    }

    var bHint = document.getElementById("biomassHint");
bHint.classList.remove("gap-positive", "gap-negative");

// CASE 1 — No biomass / no requirement
if (actualBiomass <= 0 || biomassReq === 0) {
  bHint.innerHTML =
    '<span style="font-weight:700;">Enter your current fish biomass to see if it matches plant demand.</span> Negative gap = too few fish…';
}

// CASE 2 — Gap < –0.1 (Deficit)
else if (biomassGap < -0.1) {
  bHint.innerHTML =
    '<span style="color:#f87171; font-weight:700;">Deficit:</span> your biomass is below the required level. Reduce active plant area or increase fish biomass over time.';
  bHint.classList.add("gap-negative");
}

// CASE 3 — Gap > +0.1 (Surplus)
else if (biomassGap > 0.1) {
  bHint.innerHTML =
    '<span style="color:#60a5fa; font-weight:700;">Surplus:</span> You have more biomass than required… You could add plants or slowly reduce biomass as you harvest.';
  bHint.classList.add("gap-positive");
}

// CASE 4 — Balanced
else {
  bHint.textContent =
    'Your fish biomass is well matched to the current plant feed demand.';
}
  }

  var ids = [
    "dwcLength","dwcWidth","dwcBeds","dwcFeedRate","dwcUsePct",
    "includeGravel","gravelLength","gravelWidth","gravelBeds","gravelFeedRate","gravelUsePct",
    "feedPercent","refAvgW",
    "t1AvgW","t1Count","t1FeedPct",
    "t2AvgW","t2Count","t2FeedPct",
    "t3AvgW","t3Count","t3FeedPct"
  ];
  ids.forEach(function(id) {
    var el = document.getElementById(id);
    el.addEventListener("input", updateCalc);
    el.addEventListener("change", updateCalc);
  });

  updateCalc();
</script>
</body>
</html>
